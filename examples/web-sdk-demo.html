<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Broad SDK - Web SDK æ¼”ç¤º</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .demo-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .demo-title {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #2980b9;
        }
        .btn-danger {
            background: #e74c3c;
        }
        .btn-danger:hover {
            background: #c0392b;
        }
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ Broad SDK - Web SDK æ¼”ç¤º</h1>
    
    <div class="demo-section">
        <h2 class="demo-title">1. é”™è¯¯ç›‘æ§æ¼”ç¤º</h2>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ¥æµ‹è¯•ä¸åŒç±»å‹çš„é”™è¯¯ç›‘æ§ï¼š</p>
        
        <button class="btn btn-danger" onclick="testJsError()">æµ‹è¯• JS é”™è¯¯</button>
        <button class="btn btn-danger" onclick="testPromiseError()">æµ‹è¯• Promise é”™è¯¯</button>
        <button class="btn btn-danger" onclick="testResourceError()">æµ‹è¯•èµ„æºåŠ è½½é”™è¯¯</button>
        <button class="btn btn-danger" onclick="testConsoleError()">æµ‹è¯• Console é”™è¯¯</button>
        
        <div id="error-status"></div>
    </div>

    <div class="demo-section">
        <h2 class="demo-title">2. æ€§èƒ½ç›‘æ§æ¼”ç¤º</h2>
        <p>é¡µé¢åŠ è½½æ—¶ä¼šè‡ªåŠ¨æ”¶é›†æ€§èƒ½æ•°æ®ï¼š</p>
        <div id="performance-status" class="status info">
            æ€§èƒ½ç›‘æ§å·²å¯ç”¨ï¼Œæ•°æ®å°†åœ¨é¡µé¢åŠ è½½å®Œæˆåæ”¶é›†...
        </div>
    </div>

    <div class="demo-section">
        <h2 class="demo-title">3. åŠ è½½ç®¡ç†æ¼”ç¤º</h2>
        <p>æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚çš„åŠ è½½çŠ¶æ€ï¼š</p>
        <button class="btn" onclick="testLoading()">æ¨¡æ‹Ÿè¯·æ±‚</button>
        <div id="loading-status"></div>
    </div>

    <div class="demo-section">
        <h2 class="demo-title">4. æ¥å£ç¼“å­˜æ¼”ç¤º</h2>
        <p>æµ‹è¯•æ¥å£ç¼“å­˜åŠŸèƒ½ï¼š</p>
        <button class="btn" onclick="testCache()">æµ‹è¯•ç¼“å­˜</button>
        <button class="btn" onclick="clearCache()">æ¸…é™¤ç¼“å­˜</button>
        <div id="cache-status"></div>
    </div>

    <div class="demo-section">
        <h2 class="demo-title">5. å“åº”å¼å¸ƒå±€æ¼”ç¤º</h2>
        <p>å½“å‰é¡µé¢å·²å¯ç”¨å“åº”å¼å¸ƒå±€ï¼Œè¯·è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°æŸ¥çœ‹æ•ˆæœï¼š</p>
        <div style="background: #e8f4fd; padding: 15px; border-radius: 4px;">
            <p>å½“å‰ rem åŸºå‡†å€¼ï¼š<span id="rem-value"></span></p>
            <p>å½“å‰è§†å£å®½åº¦ï¼š<span id="viewport-width"></span></p>
        </div>
    </div>

    <script type="module">
        // å¯¼å…¥ SDK
        import { MonitorJS, loadingManage, CacheData } from '../packages/web-sdk/src/index.js';
        
        // åˆå§‹åŒ–ç›‘æ§
        MonitorJS.init({
            url: 'https://api.example.com/error-report',
            jsError: true,
            promiseError: true,
            resourceError: true,
            ajaxError: true,
            consoleError: true,
            extendsInfo: {
                userId: 'demo-user',
                version: '1.0.0',
                page: 'demo'
            }
        });

        // æ€§èƒ½ç›‘æ§
        MonitorJS.monitorPerformance({
            pageId: 'demo-page',
            url: 'https://api.example.com/performance-report'
        });

        // å…¨å±€å˜é‡ä¾›æ¼”ç¤ºä½¿ç”¨
        window.MonitorJS = MonitorJS;
        window.loadingManage = loadingManage;
        window.CacheData = CacheData;

        // æ›´æ–°å“åº”å¼å¸ƒå±€ä¿¡æ¯
        function updateResponsiveInfo() {
            const remValue = getComputedStyle(document.documentElement).fontSize;
            const viewportWidth = window.innerWidth;
            
            document.getElementById('rem-value').textContent = remValue;
            document.getElementById('viewport-width').textContent = viewportWidth + 'px';
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ›´æ–°ä¿¡æ¯
        window.addEventListener('load', () => {
            updateResponsiveInfo();
            document.getElementById('performance-status').innerHTML = 
                '<div class="status success">âœ… æ€§èƒ½ç›‘æ§æ•°æ®å·²æ”¶é›†å®Œæˆï¼</div>';
        });

        // çª—å£å¤§å°æ”¹å˜æ—¶æ›´æ–°ä¿¡æ¯
        window.addEventListener('resize', updateResponsiveInfo);
    </script>

    <script>
        // æµ‹è¯•å‡½æ•°
        function testJsError() {
            try {
                throw new Error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•çš„ JS é”™è¯¯');
            } catch (error) {
                console.error('æ•è·åˆ° JS é”™è¯¯:', error);
                document.getElementById('error-status').innerHTML = 
                    '<div class="status error">âŒ JS é”™è¯¯å·²è§¦å‘å¹¶è¢«ç›‘æ§ç³»ç»Ÿæ•è·</div>';
            }
        }

        function testPromiseError() {
            Promise.reject(new Error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•çš„ Promise é”™è¯¯'))
                .catch(error => {
                    console.error('æ•è·åˆ° Promise é”™è¯¯:', error);
                    document.getElementById('error-status').innerHTML = 
                        '<div class="status error">âŒ Promise é”™è¯¯å·²è§¦å‘å¹¶è¢«ç›‘æ§ç³»ç»Ÿæ•è·</div>';
                });
        }

        function testResourceError() {
            const img = new Image();
            img.onerror = () => {
                console.error('èµ„æºåŠ è½½é”™è¯¯');
                document.getElementById('error-status').innerHTML = 
                    '<div class="status error">âŒ èµ„æºåŠ è½½é”™è¯¯å·²è§¦å‘å¹¶è¢«ç›‘æ§ç³»ç»Ÿæ•è·</div>';
            };
            img.src = 'non-existent-image.jpg';
        }

        function testConsoleError() {
            console.error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•çš„ Console é”™è¯¯');
            document.getElementById('error-status').innerHTML = 
                '<div class="status error">âŒ Console é”™è¯¯å·²è§¦å‘å¹¶è¢«ç›‘æ§ç³»ç»Ÿæ•è·</div>';
        }

        function testLoading() {
            const statusEl = document.getElementById('loading-status');
            statusEl.innerHTML = '<div class="status info">â³ å¼€å§‹æ¨¡æ‹Ÿè¯·æ±‚...</div>';

            const hideLoading = window.loadingManage({
                openLoading: true,
                showLoading: () => {
                    statusEl.innerHTML = '<div class="status info">ğŸ”„ æ˜¾ç¤º Loading...</div>';
                },
                hideLoading: () => {
                    statusEl.innerHTML = '<div class="status success">âœ… è¯·æ±‚å®Œæˆï¼ŒLoading å·²éšè—</div>';
                }
            });

            // æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚
            setTimeout(() => {
                hideLoading();
            }, 2000);
        }

        // ç¼“å­˜æµ‹è¯•ç±»
        class DemoApiService {
            @window.CacheData
            async getData(id) {
                console.log(`æ­£åœ¨è·å–æ•°æ® ${id}...`);
                // æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚
                await new Promise(resolve => setTimeout(resolve, 1000));
                return { id, data: `æ•°æ® ${id}`, timestamp: Date.now() };
            }
        }

        const apiService = new DemoApiService();

        async function testCache() {
            const statusEl = document.getElementById('cache-status');
            statusEl.innerHTML = '<div class="status info">ğŸ”„ æ­£åœ¨æµ‹è¯•ç¼“å­˜...</div>';

            try {
                const startTime = Date.now();
                const result1 = await apiService.getData(1);
                const time1 = Date.now() - startTime;

                const startTime2 = Date.now();
                const result2 = await apiService.getData(1);
                const time2 = Date.now() - startTime2;

                statusEl.innerHTML = `
                    <div class="status success">
                        âœ… ç¼“å­˜æµ‹è¯•å®Œæˆï¼<br>
                        ç¬¬ä¸€æ¬¡è¯·æ±‚: ${time1}ms<br>
                        ç¬¬äºŒæ¬¡è¯·æ±‚: ${time2}ms (ç¼“å­˜)<br>
                        æ•°æ®: ${JSON.stringify(result1)}
                    </div>
                `;
            } catch (error) {
                statusEl.innerHTML = '<div class="status error">âŒ ç¼“å­˜æµ‹è¯•å¤±è´¥</div>';
            }
        }

        function clearCache() {
            if (apiService.getData.clearCache) {
                apiService.getData.clearCache();
                document.getElementById('cache-status').innerHTML = 
                    '<div class="status success">âœ… ç¼“å­˜å·²æ¸…é™¤</div>';
            }
        }
    </script>
</body>
</html> 